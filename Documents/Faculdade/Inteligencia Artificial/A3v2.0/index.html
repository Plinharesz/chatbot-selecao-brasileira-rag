<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arena CBF - Chat Inteligente</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,800;1,800&family=Roboto:wght@400;500;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --verde: #009c3b;
            --amarelo: #ffdf00;
            --azul: #002776;
            --branco: #ffffff;
        }

        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background: repeating-linear-gradient(90deg, #008f32, #008f32 50px, #00b344 50px, #00b344 100px);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .stadium-container {
            width: 100%; max-width: 450px; height: 90vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            display: flex; flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            border: 4px solid var(--amarelo);
            overflow: hidden;
            position: relative;
        }

        .scoreboard {
            background: linear-gradient(135deg, var(--azul) 0%, #00184d 100%);
            padding: 15px 20px;
            color: var(--branco);
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 3px solid var(--verde);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .title h1 {
            margin: 0;
            font-family: 'Kanit', sans-serif;
            font-style: italic;
            font-size: 1.4rem;
            text-transform: uppercase;
        }
        .title span { font-size: 0.7rem; opacity: 0.8; }
        .stars { color: var(--amarelo); letter-spacing: 3px; font-size: 0.9rem; }

        .chat-field {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex; flex-direction: column; gap: 15px;
            background-image: radial-gradient(#ccc 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .msg {
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.6; /* Aumentei o espa√ßamento entre linhas para leitura */
            max-width: 80%;
            animation: fadeIn 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ESTILO DO MARKDOWN (NEGRITO) --- */
        strong {
            font-weight: 900;
        }

        /* Bot = Azul (Texto branco, Negrito Amarelo) */
        .bot { background-color: var(--azul); color: var(--branco); align-self: flex-start; border-bottom-left-radius: 2px; }
        .bot strong { color: var(--amarelo); } 

        /* User = Amarelo (Texto azul, Negrito Azul Escuro) */
        .user { background-color: var(--amarelo); color: var(--azul); align-self: flex-end; border-bottom-right-radius: 2px; font-weight: 600; }
        .user strong { color: #000; }

        .input-zone {
            padding: 15px;
            background: var(--branco);
            display: flex; gap: 10px;
            border-top: 1px solid #eee;
        }

        input {
            flex: 1; padding: 12px 15px; border: 2px solid #ddd; border-radius: 25px; outline: none; font-size: 1rem; transition: 0.3s;
        }
        input:focus { border-color: var(--verde); }

        button {
            background: var(--verde); color: white; border: none; width: 50px; height: 50px; border-radius: 50%;
            cursor: pointer; font-size: 1.2rem; transition: transform 0.1s;
            box-shadow: 0 4px 10px rgba(0, 156, 59, 0.3);
        }
        button:active { transform: scale(0.9); }

        .loader {
            display: none; align-self: flex-start; padding: 10px; background: #f0f0f0; border-radius: 20px;
        }
        .ball {
            width: 10px; height: 10px; background: var(--verde); border-radius: 50%; display: inline-block;
            animation: bounce 0.6s infinite alternate;
        }
        .ball:nth-child(2) { background: var(--amarelo); animation-delay: 0.2s; }
        .ball:nth-child(3) { background: var(--azul); animation-delay: 0.4s; }
        @keyframes bounce { to { transform: translateY(-8px); } }

    </style>
</head>
<body>

    <div class="stadium-container">
        <div class="scoreboard">
            <div class="title">
                <h1>Canarinho Virtual üáßüá∑</h1>
                <span>CHAT OFICIAL</span>
            </div>
            <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        </div>

        <div class="chat-field" id="chat">
            <div class="msg bot">Fala, torcedor! ‚öΩ<br>Pode perguntar qualquer coisa sobre a nossa Sele√ß√£o!</div>
        </div>

        <div class="loader" id="loader">
            <span class="ball"></span><span class="ball"></span><span class="ball"></span>
        </div>

        <div class="input-zone">
            <input type="text" id="input" placeholder="Ex: Quem tem mais gols?" onkeypress="if(event.key==='Enter') send()">
            <button onclick="send()">‚û§</button>
        </div>
    </div>

    <script>
        // --- FUN√á√ÉO NOVA PARA ARRUMAR O TEXTO ---
        function formatText(text) {
            if (!text) return "";

            // 1. Transforma **texto** em <strong>texto</strong> (Negrito bonito)
            let formatted = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // 2. Transforma * texto em ‚Ä¢ T√≥pico (Lista)
            formatted = formatted.replace(/^\* (.*$)/gm, '<br>‚Ä¢ $1');

            // 3. Transforma quebra de linha (\n) em <br> visual
            formatted = formatted.replace(/\n/g, '<br>');
            
            return formatted;
        }

        async function send() {
            const input = document.getElementById('input');
            const text = input.value.trim();
            const chat = document.getElementById('chat');
            const loader = document.getElementById('loader');

            if (!text) return;

            // 1. Adiciona msg usu√°rio
            addMsg(text, 'user');
            input.value = '';

            // 2. Carregando...
            chat.appendChild(loader);
            loader.style.display = 'block';
            chat.scrollTop = chat.scrollHeight;

            try {
                // 3. Backend
                const response = await fetch('http://localhost:8000/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: text })
                });

                const data = await response.json();
                
                // 4. Resposta Bot (Agora formatada)
                addMsg(data.resposta, 'bot');

            } catch (error) {
                console.error(error);
                addMsg("O servidor n√£o respondeu. Verifique se o terminal do Python est√° aberto.", 'bot');
            } finally {
                loader.style.display = 'none';
            }
        }

        function addMsg(text, type) {
            const chat = document.getElementById('chat');
            const div = document.createElement('div');
            div.className = 'msg ' + type;
            
            // AQUI A M√ÅGICA: Chamamos a fun√ß√£o formatText antes de exibir
            div.innerHTML = formatText(text); 
            
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }
    </script>

</body>
</html>